<!DOCTYPE html>
<html ng-app="configuration">
<head>
	<meta charset="utf-8"/>
	<link href="../../assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" href="../../css/configuration.css">
	<link rel="stylesheet" href="../../css/app.css">
	<link rel="stylesheet" href="../../css/remodal.css">
	<link rel="stylesheet" href="../../css/remodal-default-theme.css">
    <link rel="stylesheet" href="../../css/dropdown.css">

    <title>部署配置－详情</title>
</head>
<body ng-controller="configController">

<br>

<div class="remodal-bg">

<div class="container">
    <div class="col-md-4">
        <div class="input-group">
            <span class="input-group-addon">应用名称</span>
            <input type="text" class="form-control" placeholder="应用名" aria-describedby="basic-addon1"
                   ng-model="appConfig.name" ng-disabled="currentRole=='ADS_DEV'"
                   value="部署配置">
        </div>
    </div>

    <div class="col-md-8">
        <div class="input-group">
            <span class="input-group-addon">描述信息</span>
            <input type="text" class="form-control" placeholder="描述信息" aria-describedby="basic-addon1"
                   ng-model="appConfig.description" value="自动部署系统，用于部署java、node.js、ruby应用。"
                   ng-disabled="currentRole=='ADS_DEV'">
        </div>
    </div>
</div>

<br>

<div class="container">
    <div class="list-group">
        <div style="border-color:rgba(29, 39, 105, 0.30);" class="list-group-item m-b-md box-shadow-lg panel divborder" ng-repeat="appModule in appConfig.appModules" data-module-index="{{$index}}"
             data-app-id=1>
	<div class="row">
		<div class="col-md-2"><span class="label label-info" ng-bind="'模块序号：' + ($index+1)"></span></div>
		<div class="col-md-10 text-right">
			<button class="btn btn-sm  btn-info" ng-click="moveModule($index)" ng-disabled="appId==null || appModule.id==null || appModule.lockTs!=0 || currentRole=='DEV'">模块搬家<span class="glyphicon glyphicon-share-alt"></span></button>
		</div>
	</div>
    <hr class="m-t-sm m-b-sm"/>
    <div class="row">

                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-addon">模块名称</span>
                        <input ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" type="text" class="form-control" placeholder="模块名" aria-describedby="basic-addon1" ng-trim="true"
                               ng-model="appModule.name">
                               
                               <span class="input-group-btn">
                               		<button ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" class="btn btn-default" type="button"
							               ng-click="selectModuleTemplate($index)">选择模板
							       	</button>
							   </span>
                               
                    </div>
                </div>
				
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-addon" id="sizing-addon2">模块类型</span>
                        <select ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" class="form-control" ng-model="appModule.language" ng-change="languageChanged($index)">
                            <option>Java</option>
                            <option>Ruby</option>
                            <option>Nodejs</option>
                            <option>Golang</option>
                            <option>Lua</option>
                            <option>Python</option>
                        </select>
                    </div>
                </div>

        <div class="col-md-4" ng-show="appModule.gitShow">
            <div class="input-group">
                <span class="input-group-addon">git地址</span>
                <input ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" type="text" class="form-control" ng-model="appModule.codeRepertoryURL" placeholder="请输入git地址"
                       aria-describedby="basic-addon1">
            </div>
        </div>
    </div>
    
    <br/>
    
    <div class="row m-t-n-xs">
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-addon">新增过程</span>
                <input ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" type="text" class="form-control" ng-model="newAction" placeholder="过程名"
                       aria-describedby="basic-addon1">
                                   <span class="input-group-btn">
                                       <button ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" class="btn btn-default" type="button"
                                               ng-click="addAction(newAction,$index)">+
                                       </button>
                                   </span>
            </div>
        </div>
    </div>

    <br/>


    <div class="row">
        <div class="col-md-2 m-b-sm" ng-repeat="action in appModule.actions">

            <div class="dropdown">
                <span class="label label-default">{{$index+1}}</span>
                <button ng-disabled="moduleDisable[appModule.id]" class="btn btn-default dropdown-toggle" type="button"
                        id="dropdownMenu1"
                        data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="true">
                    {{action.name}}
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li>
                    	<a ng-click="editScipt()">{{editScriptMenu}}脚本</a>
                    </li>
                    <li><a ng-click="useSciptTemplate()">使用模版</a>
                    </li>
                    <li role="separator" class="divider"></li>
                    <li><a ng-click="forwardAction(appModule,$index+1)">提前</a></li>
                    <li><a ng-click="backAction(appModule,$index+1)">推后</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a ng-click="deleteAction(appModule,$index)">删除</a></li>

                    <li role="separator" class="divider"></li>

                    <li class="menu-item dropdown dropdown-submenu">
                        <a class="dropdown-toggle" data-toggle="dropdown">选择执行用户({{action.runAs}})</a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#" ng-click="setRunasUser(appModule,action,'root')">root</a>

                            <li>
                                <a href="#" ng-click="setRunasUser(appModule,action,'webuser')">webuser</a>
                            </li>
                            <li>
                                <a href="#" ng-click="setRunasUser(appModule,action,'edmuser')">edmuser</a>
                            </li>
                            <li>
                                <a href="#" ng-click="setRunasUser(appModule,action,'search')">search</a>
                            </li>
                            <li>
                                <a href="#" ng-click="setRunasUser(appModule,action,'wossuser')">wossuser</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>


        </div>


    </div>

    <br/>

    <hr class="m-t-sm m-b-sm"/>


	
    <div class="row">

        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-addon">新增配置</span>
	               <input ng-disabled="moduleDisable[appModule.id]" type="text" class="form-control" ng-model="newConfig" placeholder="配置文件别名"
	                       aria-describedby="basic-addon1">
                   <span class="input-group-btn">
                       <button ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" class="btn btn-default" type="button"
                               ng-click="addConfig(newConfig,$index)">+
                       </button>
                   </span>
            </div>
        </div>
    </div>

    <br/>




    <div class="row">
        <div class="col-md-2" ng-repeat="config in appModule.configs">
            <div class="dropdown">
                <button ng-disabled="moduleDisable[appModule.id]" class="btn btn-default dropdown-toggle" type="button"
                        id="dropdownMenu1"
                        data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="true">
                    {{config.name}}
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="javascript:void(0);"
                           ng-click="editConfig(appModule,config.id,config.rId)">编辑</a>
                    </li>

                    <li><a href="javascript:void(0);"
                           ng-click="delConfig(appModule,config.id,config.rId)">删除</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
 
    <br/>
    <hr class="m-t-sm  m-b-sm"/>
	

    <div class="row">
        <div class="col-md-4" ng-repeat="env in appModule.envs">
            <h5>{{env.name}}</h5>
            <textarea ng-disabled="moduleDisable[appModule.id] || currentRole=='ADS_DEV'" class="form-control" placeholder="不同ip之间需换行" rows="5" align="center"
                      ng-model="env.hostNames" ng-trim="true">
                192.168.1.1
                192.168.1.2
                192.168.1.3
            </textarea>
        </div>
    </div>

    <br/>

    <div class="row">
        <div class="col-md-12 text-right">
        	<button ng-disabled="moduleDisable[appModule.id]" ng-show="currentRole!='ADS_DEV'" class="btn btn-primary" ng-click="saveAppModule($index)">保存模块</button>
            <button ng-disabled="moduleDisable[appModule.id] || disabled" class="btn btn-primary" ng-click="delAppModule($index)"> 删除模块</button>
        </div>
    </div>
    
</div>


<br/>

<div class="row">
    <div align="right">
        <a ng-click="addAppModule()">增加模块...</a>
    </div>
</div>

<br/>

<div class="row">
    <div align="right">
        <button class="btn btn-primary" ng-click="saveAppConfig()" ng-show="currentRole!='ADS_DEV'"><span
                class="glyphicon glyphicon-floppy-disk"></span>保存应用
        </button>

        <button class="btn" onclick="window.close();">取消</button>
    </div>
</div>

</div>
</div>
</div>


<script type="text/ng-template" id="modal" ng-controller="RemodalAreaController">
	<div>
		<div class="modal-header">
			<button type="button" class="close" ng-click="onCancel()">
				<span aria-hidden="true">&times;</span>
			</button>
			<h1 ng-show="title">{{ title }}</h1>
			
		</div>
		<div class="modal-body">
			<div class="container">
				<div class="row">
					<p>{{ text }}</p>
				</div>
				
				<div ng-show="input" class="row">
					<div class="col-md-2 col-md-offset-2 input-group">
							<span class="input-group-addon" id="basic-addon1">{{ input.label }}</span>
							<input ng-model="inputData" type="number" min="{{ input.min }}" max="{{ input.max }}" required class="form-control" aria-describedby="basic-addon1">
						</div>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button ng-show="style=='confirm'" ng-click="onCancel()" data-remodal-action="cancel" class="remodal-cancel">取消</button>
			<button ng-click="onOk(inputData)" data-remodal-action="confirm" class="remodal-confirm">确定</button>
		</div>
	</div>
</script>
<script src="../../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../../assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../assets/global/plugins/angularjs/angular.min.js" type="text/javascript"></script>
<script src="../../assets/global/plugins/angularjs/plugins/ui-bootstrap-tpls.min.js" type="text/javascript"></script>
<script src="../../js/remodal.min.js" type="text/javascript"></script>
<script src="../../js/message_box.js" type="text/javascript"></script>
<script src="../../js/demo/configuration.js" type="text/javascript" charset="utf-8"></script>

</body>
</html>